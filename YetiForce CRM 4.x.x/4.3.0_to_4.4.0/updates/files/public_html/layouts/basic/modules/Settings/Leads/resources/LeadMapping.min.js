jQuery.Class("Settings_LeadMapping_Js",{triggerEdit:function(b){var a=jQuery.Deferred();var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(b).then(function(e){var d=jQuery(".contentsDiv");d.html(e);c.progressIndicator({mode:"hide"});var f=new Settings_LeadMapping_Js();f.registerEventsForEditView()},function(d){c.progressIndicator({mode:"hide"})});return a.promise()},triggerDelete:function(d,a){var b=jQuery(d.currentTarget);var f=b.closest(".listViewEntries");var c=f.data("cfmid");var e=a+"&mappingId="+c;AppConnector.request(e).then(function(h){var g=h.result[0];var i={text:g};if(h.success){f.remove()}else{i.type="error"}Settings_Vtiger_Index_Js.showMessage(i)},function(g){})}},{registerEventsForEditView:function(){var b=jQuery("#leadsMapping");var a=b.find(".select2");app.showSelect2ElementView(a);this.registerEventForAddingNewMapping();this.registerOnChangeEventForSourceModule();this.registerEventToDeleteMapping();this.registerEventForFormSubmit();this.registerOnChangeEventOfTargetModule();jQuery("select.accountsFields.select2,select.contactFields.select2").trigger("change",false)},registerEventForAddingNewMapping:function(){jQuery("#addMapping").on("click",function(f){var c=jQuery("#convertLeadMapping");var b=c.find("tr:not(.newMapping):last[sequence-number]").attr("sequence-number");var d=parseInt(b)+1;var g=jQuery(".newMapping").clone(true,true);g.attr("sequence-number",d);g.find("select.leadsFields.newSelect").attr("name","mapping["+d+"][lead]");g.find("select.accountsFields.newSelect").attr("name","mapping["+d+"][account]");g.find("select.contactFields.newSelect").attr("name","mapping["+d+"][contact]");g.removeClass("d-none newMapping");g.appendTo(c);g.find(".newSelect").removeClass("newSelect").addClass("select2");var a=g.find(".select2");app.showSelect2ElementView(a);jQuery("select.accountsFields.select2,select.contactFields.select2",g).trigger("change",false)})},registerOnChangeEventForSourceModule:function(){var a=jQuery("#leadsMapping");a.on("change",".leadsFields",function(j){var h=jQuery(j.currentTarget);var b=jQuery(h.closest("tr"));var i=h.val();var g=h.find('option[value="'+i+'"]');var c=g.data("type");var d=b.find("select.accountsFields.select2");var k=b.find("select.contactFields.select2");var f=a.find(".newMapping").find(".accountsFields").children().filter('[data-type="'+c+'"]').clone(true,true);var l=a.find(".newMapping").find(".contactFields").children().filter('option[data-type="'+c+'"]').clone(true,true);c=app.vtranslate("JS_"+c);b.find(".selectedFieldDataType").html(c);var m=app.vtranslate("JS_NONE");d.html(f);k.html(l);if(c!="None"){d.prepend('<option data-type="'+m+'" label="'+m+'" value="0" selected>'+m+"</option>");k.prepend('<option data-type="'+m+'" label="'+m+'" value="0" selected>'+m+"</option>")}d.trigger("chosen:updated").trigger("change",false);k.trigger("chosen:updated").trigger("change",false)})},registerEventToDeleteMapping:function(){var a=jQuery("#leadsMapping");a.on("click",".deleteMapping",function(d){var c=jQuery(d.currentTarget);var h=c.closest("tr");var g=h.attr("sequence-number");var b="mapping["+g+"][deletable]";h.prepend('<input type="hidden" name="'+b+'" />');h.data("deletable",true).hide("slow");var f={text:app.vtranslate("JS_MAPPING_DELETED_SUCCESSFULLY")};Settings_Vtiger_Index_Js.showMessage(f)})},registerEventForFormSubmit:function(){jQuery("#leadsMapping").on("submit",function(c){c.preventDefault();var a=jQuery(this).serializeFormData();var d={module:app.getModuleName(),parent:app.getParentModuleName(),action:"MappingSave",mapping:a};var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(g){if(g.success){var f={module:app.getModuleName(),parent:app.getParentModuleName(),view:"MappingDetail"};AppConnector.request(f).then(function(i){var h=jQuery(".contentsDiv");h.html(i);b.progressIndicator({mode:"hide"})})}if(!g.result.status){var e={title:app.vtranslate("JS_INVALID_MAPPING"),text:g.result,type:"error",width:"25%"}}else{e={title:app.vtranslate("JS_MAPPING_SAVED_SUCCESSFULLY"),type:"info",width:"25%"}}Vtiger_Helper_Js.showPnotify(e)},function(e){b.progressIndicator({mode:"hide"})})})},registerOnChangeEventOfTargetModule:function(){var a=jQuery("#leadsMapping");a.on("change","select.accountsFields.select2,select.contactFields.select2",function(m,n){if(typeof n=="undefined"){n=true}var k=jQuery(m.currentTarget);var l=k.children().filter("option:selected").text();var o=k.children().filter("option:selected").val();var h=k.closest("tr");var b=false;var f;if(o=="0"){o="false"}if((!n)||(o=="false")){k.attr("selectedId",o);return}var j=h.find("select.leadsFields.select2");var d=j.val();var p=j.find('option[value="'+d+'"]').text();if(d=="0"){b=true;var c={text:app.vtranslate("JS_CANT_MAP")+" "+l+" "+app.vtranslate("JS_WITH")+" "+p,type:"error"};Settings_Vtiger_Index_Js.showMessage(c)}if(k.hasClass("accountsFields")){f=jQuery('select.accountsFields.select2[selectedid="'+o+'"]')}else{if(k.hasClass("contactFields")){f=jQuery('select.contactFields.select2[selectedid="'+o+'"]')}}if(f.length>0){b=true}if(b){var r=k.attr("selectedid");var i;if(r=="false"){i=k.find('option[label="None"]').text();k.attr("selectedId","false")}else{if(r!="false"){i=k.find('option[value="'+r+'"]').text();k.attr("selectedId",r)}}var g={id:i,text:i};var q=l+" "+app.vtranslate("JS_IS_ALREADY_BEEN_MAPPED");var s={text:q,type:"error"};Settings_Vtiger_Index_Js.showMessage(s);k.val(0).trigger("change")}else{if(b==false){k.attr("selectedId",o)}}})}});