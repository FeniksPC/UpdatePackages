jQuery.Class("Settings_CustomView_Index_Js",{},{container:false,contents:false,initEvents:function(a){var b=this;a.on("click",".js-delete-filter",function(c){b.deleteFilter(c)});a.on("switchChange.bootstrapSwitch",".js-update-field",function(d,c){b.updateField(d,c)});a.on("click",".js-update,.js-create-filter",function(c){b.update(c)});a.on("change",".js-module-filter",function(c){b.registerFilterChange(c)})},update:function(c){var b=$(c.currentTarget);var a=b.data("editurl");Vtiger_CustomView_Js.loadFilterView(a)},updateField:function(d){var b=this;var c=$(d.currentTarget);var a=c.closest(".js-filter-row");$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:true}});var f={cvid:a.data("cvid"),mod:a.data("mod"),name:c.attr("name"),value:c.prop("checked")?1:0};app.saveAjax("updateField",{},f).then(function(e){b.getContainer().find(".js-module-filter").trigger("change")})},deleteFilter:function(d){var b=this;var c=$(d.currentTarget);var a=c.closest(".js-filter-row");$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:true}});app.saveAjax("delete",{},{cvid:a.data("cvid")}).then(function(){b.getContainer().find(".js-module-filter").trigger("change")})},makeFilterListSortable:function(a){var c=this;var b=a.find("tbody");if(b.children().length>1){b.each(function(){jQuery(this).sortable({containment:"tbody",revert:true,tolerance:"pointer",cursor:"move",helper:function(f,d){d.children().each(function(e,g){g=jQuery(g);g.width(g.width())});return d},update:function(f,d){c.updateSequence()}})})}},updateSequence:function(){var a=[];this.getContents().find(".js-filter-row").each(function(d,c){var b=$(c).data("cvid");a.push(b)});app.saveAjax("upadteSequences",a).then(function(b){if(b.success){Vtiger_Helper_Js.showPnotify({text:b.result.message,type:"success"})}})},registerFilterChange:function(d){var c=this;var a=$.Deferred();var b=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:true}});var f={module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName(),sourceModule:$(d.currentTarget).val()};AppConnector.requestPjax(f).then(function(g){var e=c.getContents().html(g);app.showBtnSwitch(e.find(".switchBtn"));c.makeFilterListSortable(e);c.getContainer().find(".js-create-filter").data("editurl",e.find("#js-add-filter-url").val());b.progressIndicator({mode:"hide"});a.resolve(g)},function(e){a.reject()});return a.promise()},getContainer:function(){if(this.container==false){this.container=jQuery("div.contentsDiv")}return this.container},getContents:function(){if(this.contents==false){this.contents=this.getContainer().find(".indexContents")}return this.contents},registerEvents:function(){var a=this.getContainer();this.initEvents(a);this.makeFilterListSortable(a)}});