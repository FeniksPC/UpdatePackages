jQuery.Class("Settings_Currency_Js",{currencyInstance:false,triggerAdd:function(event){event.stopPropagation();var instance=Settings_Currency_Js.currencyInstance;instance.showEditView()},triggerEdit:function(event,id){event.stopPropagation();var instance=Settings_Currency_Js.currencyInstance;instance.showEditView(id)},triggerDelete:function(event,id){event.stopPropagation();var currentTarget=jQuery(event.currentTarget);var currentTrEle=currentTarget.closest("tr");var instance=Settings_Currency_Js.currencyInstance;instance.transformEdit(id).then(function(data){var callBackFunction=function(data){var form=jQuery("#transformCurrency");App.Fields.Picklist.showSelect2ElementView(form.find("select.select2"));form.on("submit",function(e){e.preventDefault();var transferCurrencyEle=form.find('select[name="transform_to_id"]');instance.deleteCurrency(id,transferCurrencyEle,currentTrEle)})};app.showModalWindow(data,function(data){if(typeof callBackFunction=="function"){callBackFunction(data)}},{width:"500px"})},function(error,err){})}},{init:function(){Settings_Currency_Js.currencyInstance=this},showEditView:function(id){var thisInstance=this;var aDeferred=jQuery.Deferred();var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var params={};params["module"]=app.getModuleName();params["parent"]=app.getParentModuleName();params["view"]="EditAjax";params["record"]=id;AppConnector.request(params).then(function(data){var callBackFunction=function(data){var form=jQuery("#editCurrency");var record=form.find('[name="record"]').val();App.Fields.Picklist.showSelect2ElementView(form.find("select.select2"));var currencyStatus=form.find('[name="currency_status"]').is(":checked");if(record!=""&&currencyStatus){thisInstance.registerCurrencyStatusChangeEvent(form)}thisInstance.registerCurrencyNameChangeEvent(form);var params=app.validationEngineOptions;params.onValidationComplete=function(form,valid){if(valid){thisInstance.saveCurrencyDetails(form);return valid}};form.validationEngine(params);form.on("submit",function(e){e.preventDefault()})};progressIndicatorElement.progressIndicator({mode:"hide"});app.showModalWindow(data,function(data){if(typeof callBackFunction=="function"){callBackFunction(data)}},{width:"600px"})},function(error){progressIndicatorElement.progressIndicator({mode:"hide"});aDeferred.reject(error)});return aDeferred.promise()},registerCurrencyStatusChangeEvent:function(form){form.find('[name="currency_status"]').on("change",function(e){var currentTarget=jQuery(e.currentTarget);if(currentTarget.is(":checked")){form.find("div.transferCurrency").addClass("d-none")}else{form.find("div.transferCurrency").removeClass("d-none")}})},registerCurrencyNameChangeEvent:function(form){var currencyNameEle=form.find('select[name="currency_name"]');currencyNameEle.on("change",function(){var selectedCurrencyOption=currencyNameEle.find("option:selected");form.find('[name="currency_code"]').val(selectedCurrencyOption.data("code"));form.find('[name="currency_symbol"]').val(selectedCurrencyOption.data("symbol"))})},saveCurrencyDetails:function(form){var thisInstance=this;var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var data=form.serializeFormData();data["module"]=app.getModuleName();data["parent"]=app.getParentModuleName();data["action"]="SaveAjax";AppConnector.request(data).then(function(data){if(data["success"]){progressIndicatorElement.progressIndicator({mode:"hide"});app.hideModalWindow();var params={};params.text=app.vtranslate("JS_CURRENCY_DETAILS_SAVED");Settings_Vtiger_Index_Js.showMessage(params);thisInstance.loadListViewContents()}},function(error){progressIndicatorElement.progressIndicator({mode:"hide"})})},loadListViewContents:function(){var thisInstance=this;var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var params={};params["module"]=app.getModuleName();params["parent"]=app.getParentModuleName();params["view"]="List";AppConnector.request(params).then(function(data){progressIndicatorElement.progressIndicator({mode:"hide"});jQuery("#listViewContents").html(data)},function(error,err){progressIndicatorElement.progressIndicator({mode:"hide"})})},transformEdit:function(id){var aDeferred=jQuery.Deferred();var params={};params["module"]=app.getModuleName();params["parent"]=app.getParentModuleName();params["view"]="TransformEditAjax";params["record"]=id;AppConnector.request(params).then(function(data){aDeferred.resolve(data)},function(error,err){aDeferred.reject()});return aDeferred.promise()},deleteCurrency:function(id,transferCurrencyEle,currentTrEle){var transferCurrencyId=transferCurrencyEle.find("option:selected").val();var params={};params["module"]=app.getModuleName();params["parent"]=app.getParentModuleName();params["action"]="DeleteAjax";params["record"]=id;params["transform_to_id"]=transferCurrencyId;AppConnector.request(params).then(function(data){app.hideModalWindow();var params={};params.text=app.vtranslate("JS_CURRENCY_DELETED_SUCCESSFULLY");Settings_Vtiger_Index_Js.showMessage(params);currentTrEle.fadeOut("slow").remove()},function(error,err){})},triggerDisplayTypeEvent:function(){var widthType=app.cacheGet("widthType","narrowWidthType");if(widthType){var elements=jQuery(".listViewEntriesTable").find("td,th");elements.attr("class",widthType)}},registerRowClick:function(){var thisInstance=this;jQuery("#listViewContents").on("click",".listViewEntries",function(e){var currentRow=jQuery(e.currentTarget);if(currentRow.find(".fas fa-edit ").length<=0){return}thisInstance.showEditView(currentRow.data("id"))})},registerEvents:function(){this.registerRowClick()}});jQuery(document).ready(function(){var currencyInstance=new Settings_Currency_Js;currencyInstance.registerEvents()});